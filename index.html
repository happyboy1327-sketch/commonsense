<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëœë¤ ìƒì‹ í€´ì¦ˆ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font (Tailwind default) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ ë° í°íŠ¸ ì„¤ì • */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1e1e2d; /* ì§™ì€ ë°°ê²½ */
            color: #e0e0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* ë¸”ëŸ¬ íš¨ê³¼ë¥¼ ìœ„í•œ ë°°ê²½ ì»¨í…Œì´ë„ˆ */
        #app-container {
            background: rgba(30, 30, 50, 0.7); /* ë¶ˆíˆ¬ëª…í•œ ë°°ê²½ */
            backdrop-filter: blur(10px); /* ë¸”ëŸ¬ íš¨ê³¼ */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 500px;
            width: 95%;
            padding: 0;
            overflow: hidden; /* ë‚´ë¶€ ìš”ì†Œê°€ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
        }
        
        /* ë©”ì¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .gradient-button {
            background: linear-gradient(135deg, #4f46e5 0%, #a855f7 100%); /* ë³´ë¼ìƒ‰ ê³„ì—´ ê·¸ë¼ë°ì´ì…˜ */
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .gradient-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(168, 85, 247, 0.5);
        }

        .gradient-button:active {
            transform: translateY(0);
            box-shadow: none;
        }

        /* í€´ì¦ˆ ì˜µì…˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .option-button {
            background-color: #3e3e5d; /* ì˜µì…˜ ë°°ê²½ */
            border: 2px solid #5a5a7a;
            transition: background-color 0.1s, border-color 0.1s;
        }

        .option-button:hover:not(:disabled) {
            background-color: #4a4a6e;
            border-color: #8b5cf6; /* hover ì‹œ ë³´ë¼ìƒ‰ í…Œë‘ë¦¬ */
        }

        /* ì •ë‹µ/ì˜¤ë‹µ ìŠ¤íƒ€ì¼ */
        .correct {
            background-color: #10b981 !important; /* ì—ë©”ë„ë“œ ê·¸ë¦° */
            border-color: #059669 !important;
            color: white !important;
        }

        .incorrect {
            background-color: #ef4444 !important; /* ë¹¨ê°„ìƒ‰ */
            border-color: #dc2626 !important;
            color: white !important;
        }

        .faded-out {
            opacity: 0.5;
            pointer-events: none;
        }

        .quiz-card {
            border-radius: 20px;
        }
    </style>
</head>
<body>

    <div id="app-container" class="p-6">
        <header class="text-center mb-6">
            <h1 class="text-3xl font-extrabold text-white">ëœë¤ ìƒì‹ í€´ì¦ˆ</h1>
        </header>
        <div id="content" class="w-full">
            <!-- Content will be rendered here by JavaScript -->
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        // where, getDocs, deleteDoc í•¨ìˆ˜ ì¶”ê°€: ë³µìŠµ ëª©ë¡ ì˜êµ¬ ì‚­ì œë¥¼ ìœ„í•´ í•„ìš”
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, where, getDocs, deleteDoc, limit, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firestore ë””ë²„ê·¸ ë¡œê¹… í™œì„±í™”
        setLogLevel('Debug');

        // =========================================================================
        // 1. Firebase ë° ì „ì—­ ìƒíƒœ ì„¤ì •
        // =========================================================================

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth;
        let userId = 'loading'; // ì´ˆê¸° ìƒíƒœ

        // ì „ì—­ UI ìš”ì†Œ
        const contentDiv = document.getElementById('content');

        // í€´ì¦ˆ ê´€ë ¨ ìƒíƒœ
        let allQuizzes = [];          // mockQuizzesë¥¼ Map í˜•íƒœë¡œ ì €ì¥ (ê²€ìƒ‰ íš¨ìœ¨í™”)
        let currentQuizSet = [];      // í˜„ì¬ í€´ì¦ˆ ì„¸ì…˜ì— ì‚¬ìš©í•  í€´ì¦ˆ (10ê°œ)
        let reviewSet = [];           // **ì¶”ê°€: ë³µìŠµ ëª¨ë“œì—ì„œ ì‚¬ìš©í•  í€´ì¦ˆ ì„¸íŠ¸ (ê¸€ë¡œë²Œ ì´ˆê¸°í™”)**
        let currentQuizIndex = 0;     // í˜„ì¬ í’€ê³  ìˆëŠ” í€´ì¦ˆì˜ ì¸ë±ìŠ¤
        let quizHistory = [];         // ì‚¬ìš©ìê°€ í‘¼ ëª¨ë“  í€´ì¦ˆ ê¸°ë¡ (Firestore ë™ê¸°í™”)
        let timerInterval = null;     // í€´ì¦ˆ íƒ€ì´ë¨¸
        let timeRemaining = 15;       // ë¬¸ì œë‹¹ ì‹œê°„ (ì´ˆ)
        let selectedDifficulty = 'Easy'; // í˜„ì¬ ì„ íƒëœ ë‚œì´ë„
        
        /** @typedef {Object} QuizState
         * @property {string} lastAccessDate - ë§ˆì§€ë§‰ ì ‘ì† ë‚ ì§œ (YYYY-MM-DD)
         * @property {{Easy: string[], Normal: string[], Hard: string[]}} pools - ë‚œì´ë„ë³„ í˜„ì¬ ì‚¬ìš©ìì—ê²Œ ê³µê°œëœ í€´ì¦ˆ ID ëª©ë¡
         */
        /** @type {QuizState} */
        let quizState = { 
            lastAccessDate: '', 
            pools: { Easy: [], Normal: [], Hard: [] } 
        };

        // =========================================================================
        // 2. ë°ì´í„° êµ¬ì¡° ë° ëª¨ì˜ ë°ì´í„° (ë³€ê²½ ì—†ìŒ)
        // =========================================================================

        /** @typedef {Object} Quiz
         * @property {string} id
         * @property {string} question
         * @property {string[]} options
         * @property {number} answerIndex
         * @property {'Easy'|'Normal'|'Hard'} difficulty
         * @property {string} explanation // í•´ì„¤ í•„ë“œ
         */

        /** @type {Quiz[]} */
        const mockQuizzesArray = [
            // Easy
            { id: 'e1', question: 'ì§€êµ¬ìƒì—ì„œ ê°€ì¥ í° í¬ìœ ë¥˜ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ì½”ë¼ë¦¬', 'ê¸°ë¦°', 'í°ìˆ˜ì—¼ê³ ë˜', 'í•˜ë§ˆ'], answerIndex: 2, difficulty: 'Easy', explanation: 'í°ìˆ˜ì—¼ê³ ë˜(Blue Whale)ëŠ” ì§€êµ¬ìƒì— ì¡´ì¬í•˜ëŠ” ê°€ì¥ í° ë™ë¬¼ì´ë©°, ê¸¸ì´ 30m, ë¬´ê²Œ 180í†¤ì„ ì´ˆê³¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.' },
            { id: 'e2', question: 'ëŒ€í•œë¯¼êµ­ì˜ ìˆ˜ë„ëŠ” ì–´ë””ì¼ê¹Œìš”?', options: ['ë¶€ì‚°', 'ì„œìš¸', 'ì œì£¼', 'í‰ì–‘'], answerIndex: 1, difficulty: 'Easy', explanation: 'ëŒ€í•œë¯¼êµ­ì˜ ìˆ˜ë„ëŠ” ì„œìš¸íŠ¹ë³„ì‹œì…ë‹ˆë‹¤.' },
            { id: 'e3', question: 'ë¬¼ì˜ í™”í•™ ê¸°í˜¸ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', options: ['O2', 'CO2', 'H2O', 'NaCl'], answerIndex: 2, difficulty: 'Easy', explanation: 'ë¬¼ì€ ë‘ ê°œì˜ ìˆ˜ì†Œ ì›ìì™€ í•œ ê°œì˜ ì‚°ì†Œ ì›ìë¡œ ì´ë£¨ì–´ì ¸ Hâ‚‚Oë¡œ í‘œê¸°í•©ë‹ˆë‹¤.' },
            { id: 'e4', question: 'íƒœì–‘ê³„ì˜ ì¤‘ì‹¬ì— ìˆëŠ” í•­ì„±ì€ ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ì§€êµ¬', 'ë‹¬', 'í™”ì„±', 'íƒœì–‘'], answerIndex: 3, difficulty: 'Easy', explanation: 'íƒœì–‘ê³„ì˜ ì¤‘ì‹¬ì—ëŠ” íƒœì–‘ì´ ìˆìœ¼ë©°, íƒœì–‘ì€ ìŠ¤ìŠ¤ë¡œ ë¹›ì„ ë‚´ëŠ” í•­ì„±ì…ë‹ˆë‹¤.' },
            { id: 'e5', question: 'ì‚¬ê³„ì ˆ ì¤‘ ê°€ì¥ ì¶”ìš´ ê³„ì ˆì€ ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ë´„', 'ì—¬ë¦„', 'ê°€ì„', 'ê²¨ìš¸'], answerIndex: 3, difficulty: 'Easy', explanation: 'ì‚¬ê³„ì ˆ ì¤‘ ê²¨ìš¸ì´ ê¸°ì˜¨ì´ ê°€ì¥ ë‚®ì•„ ê°€ì¥ ì¶”ìš´ ê³„ì ˆì…ë‹ˆë‹¤.' },
            { id: 'e6', question: 'ëŒ€í•œë¯¼êµ­ êµ­í™”ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ê°œë‚˜ë¦¬', 'ì¥ë¯¸', 'ë¬´ê¶í™”', 'ì§„ë‹¬ë˜'], answerIndex: 2, difficulty: 'Easy', explanation: 'ëŒ€í•œë¯¼êµ­ì˜ êµ­í™”ëŠ” ë¬´ê¶í™”ì…ë‹ˆë‹¤.' },
            { id: 'e7', question: '100më¥¼ ëœ»í•˜ëŠ” ë‹¨ìœ„ëŠ”?', options: ['km', 'm', 'cm', 'hm'], answerIndex: 3, difficulty: 'Easy', explanation: '1 í—¥í† ë¯¸í„°(hm)ëŠ” 100ë¯¸í„°ì…ë‹ˆë‹¤.' },
            { id: 'e8', question: 'ê°€ì¥ í”í•œ í˜ˆì•¡í˜•ì€?', options: ['Aí˜•', 'Bí˜•', 'Oí˜•', 'ABí˜•'], answerIndex: 2, difficulty: 'Easy', explanation: 'ì „ ì„¸ê³„ì ìœ¼ë¡œ Oí˜•ì´ ê°€ì¥ í”í•œ í˜ˆì•¡í˜•ì…ë‹ˆë‹¤.' },
            { id: 'e9', question: 'ë¹›ì˜ ì†ë„ëŠ” ì´ˆë‹¹ ì•½ ëª‡ í‚¬ë¡œë¯¸í„°ì¼ê¹Œìš”?', options: ['30ë§Œ km', '3ì²œë§Œ km', '300ë§Œ km', '3ì–µ km'], answerIndex: 0, difficulty: 'Easy', explanation: 'ë¹›ì˜ ì†ë„ëŠ” ì´ˆë‹¹ ì•½ 300,000 kmì…ë‹ˆë‹¤.' },
            { id: 'e10', question: 'ì§€êµ¬ì˜ ìœ„ì„±ì€ ë¬´ì—‡ì¼ê¹Œìš”?', options: ['íƒœì–‘', 'í™”ì„±', 'ê¸ˆì„±', 'ë‹¬'], answerIndex: 3, difficulty: 'Easy', explanation: 'ì§€êµ¬ì˜ ìœ ì¼í•œ ìì—° ìœ„ì„±ì€ ë‹¬ì…ë‹ˆë‹¤.' },
            { id: 'e11', question: 'ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ì†Œì…œ ë¯¸ë””ì–´ëŠ”?', options: ['íŠ¸ìœ„í„°', 'í˜ì´ìŠ¤ë¶', 'ì¸ìŠ¤íƒ€ê·¸ë¨', 'í‹±í†¡'], answerIndex: 1, difficulty: 'Easy', explanation: 'í˜ì´ìŠ¤ë¶(Meta)ì´ ê°€ì¥ ë§ì€ í™œì„± ì‚¬ìš©ìë¥¼ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.' },
            { id: 'e12', question: 'í•œêµ­ì—ì„œ ê°€ì¥ ë†’ì€ ì‚°ì€?', options: ['ì„¤ì•…ì‚°', 'ì§€ë¦¬ì‚°', 'í•œë¼ì‚°', 'ë°±ë‘ì‚°'], answerIndex: 2, difficulty: 'Easy', explanation: 'í•œêµ­ì—ì„œ ê°€ì¥ ë†’ì€ ì‚°ì€ ì œì£¼ë„ì˜ í•œë¼ì‚°ì…ë‹ˆë‹¤.' },
            // Normal
            { id: 'n1', question: 'ë¥´ë„¤ìƒìŠ¤ ì‹œëŒ€ì˜ ëŒ€í‘œì ì¸ í™”ê°€ë¡œ "ëª¨ë‚˜ë¦¬ì"ë¥¼ ê·¸ë¦° ì‚¬ëŒì€ ëˆ„êµ¬ì¼ê¹Œìš”?', options: ['ë¹ˆì„¼íŠ¸ ë°˜ ê³ í', 'ë ˆì˜¤ë‚˜ë¥´ë„ ë‹¤ë¹ˆì¹˜', 'íŒŒë¸”ë¡œ í”¼ì¹´ì†Œ', 'í´ë¡œë“œ ëª¨ë„¤'], answerIndex: 1, difficulty: 'Normal', explanation: 'ë ˆì˜¤ë‚˜ë¥´ë„ ë‹¤ë¹ˆì¹˜(Leonardo da Vinci)ëŠ” ëª¨ë‚˜ë¦¬ì ì™¸ì—ë„ ìµœí›„ì˜ ë§Œì°¬ ë“±ì˜ ê±¸ì‘ì„ ë‚¨ê²¼ìŠµë‹ˆë‹¤.' },
            { id: 'n2', question: 'ì¤‘êµ­ì˜ ë§Œë¦¬ì¥ì„±ì€ ë¬´ì—‡ì„ ë§‰ê¸° ìœ„í•´ ê±´ì„¤ë˜ì—ˆì„ê¹Œìš”?', options: ['ìì—°ì¬í•´', 'ì´ë¯¼ì ìœ ì…', 'ë¶ë°© ë¯¼ì¡±ì˜ ì¹¨ì…', 'ë¬´ì—­ì„  ì¶œì…'], answerIndex: 2, difficulty: 'Normal', explanation: 'ë§Œë¦¬ì¥ì„±ì€ ê³ ëŒ€ ì¤‘êµ­ì˜ ì—¬ëŸ¬ ì™•ì¡°ë“¤ì´ ë¶ìª½ì˜ í‰ë…¸ì™€ ê°™ì€ ë¶ë°© ìœ ëª© ë¯¼ì¡±ì˜ ì¹¨ì…ì„ ë§‰ê¸° ìœ„í•´ ê±´ì„¤í•œ ë°©ì–´ ì‹œì„¤ì…ë‹ˆë‹¤.' },
            { id: 'n3', question: 'ë…¸ë²¨ìƒì„ ìˆ˜ì—¬í•˜ëŠ” ë‚˜ë¼ëŠ” ì–´ë””ì¼ê¹Œìš”?', options: ['ë¯¸êµ­', 'ì˜êµ­', 'ìŠ¤ì›¨ë´', 'í”„ë‘ìŠ¤'], answerIndex: 2, difficulty: 'Normal', explanation: 'ë…¸ë²¨ìƒì€ ìŠ¤ì›¨ë´ì˜ ê³¼í•™ì ì•Œí”„ë ˆë“œ ë…¸ë²¨ì˜ ìœ ì–¸ì— ë”°ë¼ ìŠ¤ì›¨ë´ ì™•ë¦½ ê³¼í•™ì› ë“± ìŠ¤ì›¨ë´ ê¸°ê´€ê³¼ ë…¸ë¥´ì›¨ì´ ë…¸ë²¨ìœ„ì›íšŒê°€ ìˆ˜ì—¬í•©ë‹ˆë‹¤.' },
            { id: 'n4', question: 'ì¸ì²´ì˜ ë¼ˆ ì¤‘ ê°€ì¥ ê¸´ ë¼ˆëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ì‡„ê³¨', 'ê²½ê³¨', 'ëŒ€í‡´ê³¨', 'ì²™ì¶”'], answerIndex: 2, difficulty: 'Normal', explanation: 'ëŒ€í‡´ê³¨(Femur)ì€ í—ˆë²…ì§€ì— ìˆëŠ” ë¼ˆë¡œ, ì¸ì²´ì—ì„œ ê°€ì¥ í¬ê³  ê¸´ ë¼ˆì…ë‹ˆë‹¤.' },
            { id: 'n5', question: 'ì…°ìµìŠ¤í”¼ì–´ì˜ 4ëŒ€ ë¹„ê·¹ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ì‘í’ˆì€ ë¬´ì—‡ì¼ê¹Œìš”?', options: ['í–„ë¦¿', 'ë¦¬ì–´ì™•', 'ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£', 'ë§¥ë² ìŠ¤'], answerIndex: 2, difficulty: 'Normal', explanation: 'ì…°ìµìŠ¤í”¼ì–´ì˜ 4ëŒ€ ë¹„ê·¹ì€ í–„ë¦¿, ì˜¤ì…€ë¡œ, ë¦¬ì–´ì™•, ë§¥ë² ìŠ¤ì…ë‹ˆë‹¤. ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£ì€ 5ëŒ€ ë¹„ê·¹ì— ì†í•˜ë‚˜ 4ëŒ€ ë¹„ê·¹ì—ëŠ” í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.' },
            { id: 'n6', question: 'íŒŒë¦¬ ê¸°í›„ë³€í™”í˜‘ì •ì´ ì±„íƒëœ ì—°ë„ëŠ”?', options: ['2012ë…„', '2015ë…„', '2018ë…„', '2021ë…„'], answerIndex: 1, difficulty: 'Normal', explanation: 'íŒŒë¦¬ í˜‘ì •ì€ 2015ë…„ 12ì›” í”„ë‘ìŠ¤ íŒŒë¦¬ì—ì„œ ì—´ë¦° ì œ21ì°¨ ìœ ì—” ê¸°í›„ë³€í™”í˜‘ì•½ ë‹¹ì‚¬êµ­ì´íšŒì—ì„œ ì±„íƒë˜ì—ˆìŠµë‹ˆë‹¤.' },
            { id: 'n7', question: 'ë¯¸êµ­ì˜ ì´ˆëŒ€ ëŒ€í†µë ¹ì€ ëˆ„êµ¬ì¼ê¹Œìš”?', options: ['í† ë¨¸ìŠ¤ ì œí¼ìŠ¨', 'ì¡´ ì• ë¤ìŠ¤', 'ì¡°ì§€ ì›Œì‹±í„´', 'ì—ì´ë¸ŒëŸ¬í–„ ë§ì»¨'], answerIndex: 2, difficulty: 'Normal', explanation: 'ì¡°ì§€ ì›Œì‹±í„´ì€ ë¯¸êµ­ì˜ ì´ˆëŒ€ ëŒ€í†µë ¹ì…ë‹ˆë‹¤.' },
            { id: 'n8', question: 'ì§€êµ¬ ìê¸°ì¥ì˜ ì—­ì „ ì£¼ê¸°ëŠ” í‰ê· ì ìœ¼ë¡œ ì–¼ë§ˆì¼ê¹Œìš”?', options: ['ìˆ˜ë°± ë…„', 'ìˆ˜ë§Œ ë…„', 'ìˆ˜ì‹­ë§Œ ë…„', 'ìˆ˜ë°±ë§Œ ë…„'], answerIndex: 2, difficulty: 'Normal', explanation: 'ì§€êµ¬ ìê¸°ì¥ì˜ ì—­ì „ ì£¼ê¸°ëŠ” ì¼ì •í•˜ì§€ ì•Šì§€ë§Œ, í‰ê· ì ìœ¼ë¡œ ìˆ˜ì‹­ë§Œ ë…„ì— í•œ ë²ˆ ë°œìƒí•©ë‹ˆë‹¤.' },
            // **[ìˆ˜ì •ë¨]** 'ë¸”ë£¨ì¹©'ì„ ê°ì‹¸ëŠ” ë‚´ë¶€ ë”°ì˜´í‘œë¥¼ í°ë”°ì˜´í‘œ(")ë¡œ ë³€ê²½í•˜ì—¬ ì™¸ë¶€ ë”°ì˜´í‘œ(')ì™€ì˜ ì¶©ëŒì„ ë°©ì§€í–ˆìŠµë‹ˆë‹¤.
            { id: 'n9', question: 'ì£¼ì‹ ì‹œì¥ì—ì„œ "ë¸”ë£¨ì¹©"ì´ë€ ë¬´ì—‡ì„ ì˜ë¯¸í• ê¹Œìš”?', options: ['ê°“ ìƒì¥ëœ ì£¼ì‹', 'ê°€ê²© ë³€ë™ì„±ì´ í° ì£¼ì‹', 'ëŒ€í˜• ìš°ëŸ‰ì£¼', 'IT ê´€ë ¨ ê¸°ìˆ ì£¼'], answerIndex: 2, difficulty: 'Normal', explanation: 'ë¸”ë£¨ì¹©(Blue Chip)ì€ ì•ˆì •ì ì´ê³  ì¬ë¬´ ìƒíƒœê°€ ê±´ì „í•œ ëŒ€í˜• ìš°ëŸ‰ ê¸°ì—…ì˜ ì£¼ì‹ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.' },
            { id: 'n10', question: 'ë…ì¼ì˜ í†µì¼ì„ ìƒì§•í•˜ëŠ” ë¬¸ì€ ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ê°œì„ ë¬¸', 'ë¸Œë€ë´ë¶€ë¥´í¬ ë¬¸', 'ì½œë¡œì„¸ì›€', 'ë² ë¥¼ë¦° ì¥ë²½'], answerIndex: 1, difficulty: 'Normal', explanation: 'ë¸Œë€ë´ë¶€ë¥´í¬ ë¬¸ì€ ë² ë¥¼ë¦°ì— ìœ„ì¹˜í•˜ë©° ë…ì¼ ë¶„ë‹¨ê³¼ í†µì¼ì˜ ìƒì§•ì…ë‹ˆë‹¤.' },
            { id: 'n11', question: 'ëŸ¬ì‹œì•„ì˜ ìˆ˜ë„ëŠ”?', options: ['ìƒíŠ¸í˜í…Œë¥´ë¶€ë¥´í¬', 'í‚¤ì´ìš°', 'ëª¨ìŠ¤í¬ë°”', 'ë¯¼ìŠ¤í¬'], answerIndex: 2, difficulty: 'Normal', explanation: 'ëŸ¬ì‹œì•„ì˜ ìˆ˜ë„ëŠ” ëª¨ìŠ¤í¬ë°”ì…ë‹ˆë‹¤.' },
            { id: 'n12', question: 'ì„¸í¬ì˜ ì—ë„ˆì§€ ìƒì‚° ê³µì¥ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ê²ƒì€?', options: ['í•µ', 'ë¦¬ë³´ì†œ', 'ë¯¸í† ì½˜ë“œë¦¬ì•„', 'ì—½ë¡ì²´'], answerIndex: 2, difficulty: 'Normal', explanation: 'ë¯¸í† ì½˜ë“œë¦¬ì•„ëŠ” ì„¸í¬ í˜¸í¡ì„ í†µí•´ ATPë¥¼ ìƒì„±í•˜ëŠ” ì„¸í¬ ì†Œê¸°ê´€ì…ë‹ˆë‹¤.' },
            // Hard
            { id: 'h1', question: 'ì–‘ìì—­í•™ì—ì„œ ë¶ˆí™•ì •ì„± ì›ë¦¬ë¥¼ ì œì•ˆí•œ ê³¼í•™ìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?', options: ['ì•„ì¸ìŠˆíƒ€ì¸', 'ë³´ì–´', 'í•˜ì´ì  ë² ë¥´í¬', 'ìŠˆë¢°ë”©ê±°'], answerIndex: 2, difficulty: 'Hard', explanation: 'ë² ë¥´ë„ˆ í•˜ì´ì  ë² ë¥´í¬(Werner Heisenberg)ëŠ” ì…ìì˜ ìœ„ì¹˜ì™€ ìš´ë™ëŸ‰ì„ ë™ì‹œì— ì •í™•í•˜ê²Œ ì¸¡ì •í•  ìˆ˜ ì—†ë‹¤ëŠ” ë¶ˆí™•ì •ì„± ì›ë¦¬ë¥¼ ì œì•ˆí–ˆìŠµë‹ˆë‹¤.' },
            { id: 'h2', question: 'ê³ ëŒ€ ë¡œë§ˆì˜ ìœ¨ë¦¬ìš°ìŠ¤ ì¹´ì´ì‚¬ë¥´ê°€ ë‚¨ê¸´ ìœ ëª…í•œ ë§ "ì™”ë…¸ë¼, ë³´ì•˜ë…¸ë¼, ì´ê²¼ë…¸ë¼"ì˜ ë¼í‹´ì–´ ì›ë¬¸ì€ ë¬´ì—‡ì¼ê¹Œìš”?', options: ['Carpe Diem', 'Veni, Vidi, Vici', 'Alea iacta est', 'Et tu, Brute?'], answerIndex: 1, difficulty: 'Hard', explanation: '"Veni, Vidi, Vici"ëŠ” ì¹´ì´ì‚¬ë¥´ê°€ ê¸°ì›ì „ 47ë…„ ì ¤ë¼ ì „íˆ¬ì—ì„œ ìŠ¹ë¦¬í•œ í›„ ë¡œë§ˆì— ë³´ë‚¸ ë³´ê³ ì„œì— ì“´ ë¬¸êµ¬ë¡œ ì•Œë ¤ì ¸ ìˆìŠµë‹ˆë‹¤.' },
            { id: 'h3', question: 'ê²½ì œí•™ì—ì„œ "ë³´ì´ì§€ ì•ŠëŠ” ì†" ê°œë…ì„ ì œì‹œí•œ í•™ìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?', options: ['ì¡´ ë©”ì´ë„ˆë“œ ì¼€ì¸ìŠ¤', 'ì¹¼ ë§ˆë¥´í¬ìŠ¤', 'ì• ë¤ ìŠ¤ë¯¸ìŠ¤', 'ë°€í„´ í”„ë¦¬ë“œë¨¼'], answerIndex: 2, difficulty: 'Hard', explanation: 'ì• ë¤ ìŠ¤ë¯¸ìŠ¤(Adam Smith)ëŠ” êµ­ë¶€ë¡ (The Wealth of Nations)ì—ì„œ ì‹œì¥ ê²½ì œê°€ ê°œì¸ì˜ ì´ê¸°ì‹¬ì— ì˜í•´ ì¡°ì •ëœë‹¤ëŠ” "ë³´ì´ì§€ ì•ŠëŠ” ì†" ê°œë…ì„ ì œì‹œí–ˆìŠµë‹ˆë‹¤.' },
            { id: 'h4', question: '1905ë…„ ì•„ì¸ìŠˆíƒ€ì¸ì´ ë°œí‘œí•œ 4í¸ì˜ ë…¼ë¬¸ì€ ê¸°ì ì˜ í•´ ë…¼ë¬¸(Annus Mirabilis Papers)ì´ë¼ ë¶ˆë¦½ë‹ˆë‹¤. ì´ ë…¼ë¬¸ë“¤ì— í¬í•¨ë˜ì§€ ì•ŠëŠ” ì£¼ì œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ê´‘ì „ íš¨ê³¼', 'ë¸Œë¼ìš´ ìš´ë™', 'íŠ¹ìˆ˜ ìƒëŒ€ì„± ì´ë¡ ', 'ì–‘ìì¥ ì´ë¡ '], answerIndex: 3, difficulty: 'Hard', explanation: 'ì•„ì¸ìŠˆíƒ€ì¸ì˜ 1905ë…„ ë…¼ë¬¸ì€ ê´‘ì „ íš¨ê³¼, ë¸Œë¼ìš´ ìš´ë™, íŠ¹ìˆ˜ ìƒëŒ€ì„± ì´ë¡ , ê·¸ë¦¬ê³  ì§ˆëŸ‰-ì—ë„ˆì§€ ë“±ê°€ì„±(E=mcÂ²)ì„ ë‹¤ë£¨ì—ˆìœ¼ë©°, ì–‘ìì¥ ì´ë¡ ì€ ì´í›„ì— ë°œì „í•œ ê°œë…ì…ë‹ˆë‹¤.' },
            { id: 'h5', question: 'í”„ë‘ìŠ¤ í˜ëª…ì˜ êµ¬í˜¸ì¸ "ììœ , í‰ë“±, ë°•ì• " ì¤‘ "ë°•ì• "ì— í•´ë‹¹í•˜ëŠ” í”„ë‘ìŠ¤ì–´ ë‹¨ì–´ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', options: ['LibertÃ©', 'Ã‰galitÃ©', 'FraternitÃ©', 'Justice'], answerIndex: 2, difficulty: 'Hard', explanation: 'í”„ë‘ìŠ¤ í˜ëª…ì˜ êµ¬í˜¸ëŠ” LibertÃ©(ììœ ), Ã‰galitÃ©(í‰ë“±), FraternitÃ©(ë°•ì• )ì…ë‹ˆë‹¤.' },
            { id: 'h6', question: 'ì „ìê¸°í•™ì˜ ê¸°ì´ˆê°€ ë˜ëŠ” 4ê°€ì§€ ë°©ì •ì‹ì„ ì™„ì„±í•œ ê³¼í•™ìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?', options: ['ë§ˆì´í´ íŒ¨ëŸ¬ë°ì´', 'ì œì„ìŠ¤ í´ëŸ¬í¬ ë§¥ìŠ¤ì›°', 'ë‹ˆì½œë¼ í…ŒìŠ¬ë¼', 'ì•™ë“œë ˆ ë§ˆë¦¬ ì•™í˜ë¥´'], answerIndex: 1, difficulty: 'Hard', explanation: 'ì œì„ìŠ¤ í´ëŸ¬í¬ ë§¥ìŠ¤ì›°(James Clerk Maxwell)ì€ ì „ìê¸° í˜„ìƒì„ í†µí•©ì ìœ¼ë¡œ ì„¤ëª…í•˜ëŠ” ë§¥ìŠ¤ì›° ë°©ì •ì‹ì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.' },
            { id: 'h7', question: 'í—¤ë°ì›¨ì´ì˜ ì†Œì„¤ "ë…¸ì¸ê³¼ ë°”ë‹¤"ì˜ ë°°ê²½ì´ ë˜ëŠ” ë‚˜ë¼ëŠ” ì–´ë””ì¼ê¹Œìš”?', options: ['ìŠ¤í˜ì¸', 'ë¯¸êµ­', 'ì¿ ë°”', 'ë©•ì‹œì½”'], answerIndex: 2, difficulty: 'Hard', explanation: '"ë…¸ì¸ê³¼ ë°”ë‹¤"ëŠ” ì¿ ë°”ë¥¼ ë°°ê²½ìœ¼ë¡œ í•˜ë©°, ë…¸ì¸ì˜ ì´ë¦„ì€ ì‚°í‹°ì•„ê³ ì…ë‹ˆë‹¤.' },
            { id: 'h8', question: 'êµ­ì œ í‘œì¤€í™” ê¸°êµ¬(ISO)ì˜ ì•½ìëŠ” ì–´ëŠ ë‚˜ë¼ì˜ ì–¸ì–´ì—ì„œ ìœ ë˜í–ˆì„ê¹Œìš”?', options: ['ì˜ì–´', 'í”„ë‘ìŠ¤ì–´', 'ê·¸ë¦¬ìŠ¤ì–´', 'ë¼í‹´ì–´'], answerIndex: 2, difficulty: 'Hard', explanation: 'ISOëŠ” International Organization for Standardizationì˜ ì•½ìì´ì§€ë§Œ, ì´ë¦„ì€ ê·¸ë¦¬ìŠ¤ì–´ì˜ "isos"(ë™ì¼í•˜ë‹¤)ì—ì„œ ìœ ë˜í–ˆìŠµë‹ˆë‹¤.' },
            { id: 'h9', question: 'ì²œë¬¸í•™ì—ì„œ ë³„ì˜ ë°ê¸°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë“±ê¸‰ ì²´ê³„ì—ì„œ, ìˆ«ìê°€ ë‚®ì„ìˆ˜ë¡ ë” ë°ìŠµë‹ˆë‹¤. ì´ ë“±ê¸‰ ì²´ê³„ë¥¼ ê³ ì•ˆí•œ ê³ ëŒ€ ê·¸ë¦¬ìŠ¤ì˜ ì²œë¬¸í•™ìëŠ” ëˆ„êµ¬ì¼ê¹Œìš”?', options: ['í”„í†¨ë ˆë§ˆì´ì˜¤ìŠ¤', 'íˆíŒŒë¥´ì½”ìŠ¤', 'ìœ í´ë¦¬ë“œ', 'ì•„ë¦¬ìŠ¤í† í…”ë ˆìŠ¤'], answerIndex: 1, difficulty: 'Hard', explanation: 'íˆíŒŒë¥´ì½”ìŠ¤(Hipparchus)ëŠ” ë³„ì˜ ë°ê¸°ë¥¼ 6ë“±ê¸‰ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ìµœì´ˆì˜ ì„±í‘œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.' },
            { id: 'h10', question: 'ì² í•™ì ë‹ˆì²´ê°€ "ì‹ ì€ ì£½ì—ˆë‹¤"ë¼ê³  ì„ ì–¸í•œ ì£¼ìš” ì €ì„œëŠ” ë¬´ì—‡ì¼ê¹Œìš”?', options: ['ë„ë•ì˜ ê³„ë³´', 'ì°¨ë¼íˆ¬ìŠ¤íŠ¸ë¼ëŠ” ì´ë ‡ê²Œ ë§í–ˆë‹¤', 'ì„ ì•…ì˜ ì €í¸', 'ì¸ê°„ì ì¸, ë„ˆë¬´ë‚˜ ì¸ê°„ì ì¸'], answerIndex: 1, difficulty: 'Hard', explanation: '"ì°¨ë¼íˆ¬ìŠ¤íŠ¸ë¼ëŠ” ì´ë ‡ê²Œ ë§í–ˆë‹¤"ì—ì„œ ë‹ˆì²´ëŠ” "ì‹ ì€ ì£½ì—ˆë‹¤"ëŠ” ì„ ì–¸ì„ í†µí•´ ì„œêµ¬ ì‚¬íšŒì˜ ê·¼ë³¸ì ì¸ ê°€ì¹˜ ë¶•ê´´ë¥¼ ì•Œë ¸ìŠµë‹ˆë‹¤.' },
        ];
        
        // í€´ì¦ˆ ë°°ì—´ì„ ID ê¸°ë°˜ ë§µìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ê²€ìƒ‰ íš¨ìœ¨ì„±ì„ ë†’ì„
        mockQuizzesArray.forEach(q => allQuizzes[q.id] = q);

        // =========================================================================
        // 3. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        // =========================================================================

        /** @description ì˜¤ëŠ˜ì˜ ë‚ ì§œë¥¼ 'YYYY-MM-DD' í˜•ì‹ìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤. */
        function getTodayDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // =========================================================================
        // 4. Firebase Firestore ë° ì¸ì¦ (Auth) ë° ë°ì´í„° ê´€ë¦¬
        // =========================================================================
        
        /** @description í€´ì¦ˆ ìƒíƒœ ë¬¸ì„œ ê²½ë¡œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. */
        function getQuizStateDocRef() {
            const docPath = `/artifacts/${appId}/users/${userId}/quizState/state`;
            return doc(db, docPath);
        }

        /** @description í€´ì¦ˆ íˆìŠ¤í† ë¦¬ ì»¬ë ‰ì…˜ ê²½ë¡œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. (ì‹ ê·œ ì¶”ê°€) */
        function getHistoryCollectionRef() {
            return collection(db, `/artifacts/${appId}/users/${userId}/quizHistory`);
        }

        /** @description LocalStorageì— í€´ì¦ˆ íˆìŠ¤í† ë¦¬ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. (ë¹„ì¸ê°€/ìµëª… ì‚¬ìš©ììš©) */
        function saveQuizHistory(history) {
            localStorage.setItem(`quizHistory_${userId}`, JSON.stringify(history));
        }

        /** @description LocalStorageì— í€´ì¦ˆ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤. (ë¹„ì¸ê°€/ìµëª… ì‚¬ìš©ììš©) */
        function saveQuizStateLocal() {
            localStorage.setItem(`quizState_${userId}`, JSON.stringify(quizState));
        }

        /** @description í€´ì¦ˆ ê²°ê³¼ë¥¼ Firestore ë˜ëŠ” LocalStorageì— ì €ì¥í•©ë‹ˆë‹¤. */
        async function saveQuizResult(quizId, isCorrect, difficulty) {
            const newEntry = {
                quizId,
                isCorrect,
                difficulty,
                timestamp: Date.now()
            };
            
            const isFirestore = db && userId && !userId.startsWith('error-') && !userId.startsWith('anon-') && !userId.startsWith('anonymous-');

            if (isFirestore) {
                // Firestoreì— ì €ì¥
                const historyCollectionPath = `/artifacts/${appId}/users/${userId}/quizHistory`;
                try {
                    // ê³ ìœ  ë¬¸ì„œ ID ìƒì„±
                    const docId = `${difficulty}_${Date.now()}_${Math.random().toString(36).substring(2, 6)}`;
                    await setDoc(doc(db, historyCollectionPath, docId), newEntry);
                } catch (error) {
                    console.error("Error saving history to Firestore:", error);
                }
            } else {
                // LocalStorageì— ì €ì¥
                quizHistory.unshift(newEntry); // ìµœì‹  í•­ëª©ì„ ì•ì— ì¶”ê°€
                quizHistory = quizHistory.slice(0, 50); // ìµœëŒ€ 50ê°œ í•­ëª© ìœ ì§€
                saveQuizHistory(quizHistory);
            }
        }
        
        /** @description í€´ì¦ˆ ìƒíƒœë¥¼ Firestore ë˜ëŠ” LocalStorageì— ì €ì¥í•©ë‹ˆë‹¤. */
        async function saveQuizState() {
            const isFirestore = db && userId && !userId.startsWith('error-') && !userId.startsWith('anon-') && !userId.startsWith('anonymous-');
            
            if (isFirestore) {
                // Firestoreì— ì €ì¥
                try {
                    await setDoc(getQuizStateDocRef(), quizState);
                    console.log("Quiz State saved to Firestore.");
                } catch (error) {
                    console.error("Error saving quiz state to Firestore:", error);
                    saveQuizStateLocal(); // Firestore ì‹¤íŒ¨ ì‹œ LocalStorageì— ë°±ì—…
                }
            } else {
                // LocalStorageì— ì €ì¥
                saveQuizStateLocal();
                console.log("Quiz State saved to LocalStorage.");
            }
        }
        
        /** @description í€´ì¦ˆ ìƒíƒœë¥¼ Firestore ë˜ëŠ” LocalStorageì—ì„œ ë¡œë“œí•©ë‹ˆë‹¤. */
        async function loadQuizState() {
            const isFirestore = db && userId && !userId.startsWith('error-') && !userId.startsWith('anon-') && !userId.startsWith('anonymous-');

            if (isFirestore) {
                try {
                    const docSnap = await getDoc(getQuizStateDocRef());
                    if (docSnap.exists()) {
                        quizState = docSnap.data();
                        console.log("Quiz State loaded from Firestore.");
                    } else {
                        console.log("No Quiz State found in Firestore. Initializing.");
                        // Firestoreì— ì´ˆê¸° ìƒíƒœ ì €ì¥ ì‹œë„
                        await saveQuizState(); 
                    }
                } catch (error) {
                    console.error("Error loading quiz state from Firestore:", error);
                    // Firestore ì‹¤íŒ¨ ì‹œ LocalStorageì—ì„œ ë¡œë“œ ì‹œë„
                    const localState = localStorage.getItem(`quizState_${userId}`);
                    if (localState) {
                        quizState = JSON.parse(localState);
                        console.log("Quiz State loaded from LocalStorage (Firestore fallback).");
                    }
                }
            } else {
                // LocalStorageì—ì„œ ë¡œë“œ
                const localState = localStorage.getItem(`quizState_${userId}`);
                if (localState) {
                    quizState = JSON.parse(localState);
                    console.log("Quiz State loaded from LocalStorage.");
                }
            }
        }

        /** @description Firebase ì¸ì¦ ë° Firestoreë¥¼ ì´ˆê¸°í™”í•˜ê³  ì‚¬ìš©ì IDë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤. */
        async function initializeFirebase() {
            if (firebaseConfig) {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            } else {
                // Firebase configê°€ ì—†ëŠ” ê²½ìš° ìµëª… ëª¨ë“œë¡œ ëŒ€ì²´
                console.error("Firebase config is missing. Running in anonymous mode.");
                auth = { currentUser: { uid: 'anonymous-' + Math.random().toString(36).substring(2, 9) } };
                userId = auth.currentUser.uid;
                await loadQuizState(); // ì´ˆê¸° ìƒíƒœ ë¡œë“œ
                startListeningToHistory();
                renderMainMenu();
                return;
            }

            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase Auth error:", error);
                auth.currentUser = { uid: 'error-' + Math.random().toString(36).substring(2, 9) };
            }
            
            // ì¸ì¦ ìƒíƒœ ë³€í™” ë¦¬ìŠ¤ë„ˆ
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    userId = auth.currentUser?.uid || 'anon-' + Math.random().toString(36).substring(2, 9);
                }
                console.log("User ID set:", userId);
                await loadQuizState(); // í€´ì¦ˆ ìƒíƒœ ë¡œë“œ
                startListeningToHistory(); // íˆìŠ¤í† ë¦¬ ë¦¬ìŠ¤ë„ˆ ì‹œì‘
                renderMainMenu(); // ë©”ì¸ ë©”ë‰´ ë Œë”ë§
            });
        }
        
        /** @description Firestoreì—ì„œ í€´ì¦ˆ íˆìŠ¤í† ë¦¬ ë³€ê²½ ì‚¬í•­ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì‹ í•˜ê±°ë‚˜ LocalStorageì—ì„œ ë¡œë“œí•©ë‹ˆë‹¤. */
        function startListeningToHistory() {
            const isFirestore = db && userId && !userId.startsWith('error-') && !userId.startsWith('anon-') && !userId.startsWith('anonymous-');
            
            if (!isFirestore) {
                 // íŒŒì´ì–´ë² ì´ìŠ¤ê°€ ì—†ê±°ë‚˜, ìµëª…/ì—ëŸ¬ ìœ ì €ì¸ ê²½ìš° LocalStorageì—ì„œ ë¡œë“œ
                console.warn("Firestore history listening skipped. Loading from LocalStorage.");
                quizHistory = JSON.parse(localStorage.getItem(`quizHistory_${userId}`)) || [];
                quizHistory.sort((a, b) => b.timestamp - a.timestamp);
                return; 
            }

            const historyCollectionPath = `/artifacts/${appId}/users/${userId}/quizHistory`;
            // ìµœëŒ€ 50ê°œì˜ ìµœê·¼ ê¸°ë¡ë§Œ ë™ê¸°í™”í•˜ì—¬ ë¶€í•˜ë¥¼ ì¤„ì„
            const q = query(collection(db, historyCollectionPath), limit(50), orderBy('timestamp', 'desc')); 

            onSnapshot(q, (snapshot) => {
                const history = [];
                snapshot.forEach((doc) => {
                    history.push(doc.data());
                });
                quizHistory = history; 
                // ë©”ì¸ ë©”ë‰´ì— ë³€ê²½ ì‚¬í•­ ë°˜ì˜
                if (document.getElementById('content-title')?.innerText === 'ë©”ì¸ ë©”ë‰´') {
                    renderMainMenu();
                }
                console.log("Quiz History updated from Firestore:", quizHistory.length);
            }, (error) => {
                console.error("Error listening to history:", error);
            });
        }
        
        // =========================================================================
        // 5. í€´ì¦ˆ í’€ ê´€ë¦¬ ë¡œì§ (ë³€ê²½ ì—†ìŒ)
        // =========================================================================
        
        /** @description í€´ì¦ˆ í’€ì— ì‹ ê·œ ë¬¸ì œë¥¼ ì¶”ê°€í•˜ê³  ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. */
        async function updateQuizPool(difficulty) {
            const today = getTodayDate();
            let newQuizCount = 0;
            const currentPool = quizState.pools[difficulty];

            // 1. ì¶”ê°€í•´ì•¼ í•  ë¬¸ì œ ìˆ˜ ê²°ì •
            if (quizState.lastAccessDate !== today) {
                // ì˜¤ëŠ˜ ìµœì´ˆ ì ‘ì†: 8ê°œ ì¶”ê°€
                newQuizCount = 8;
                quizState.lastAccessDate = today; // ë‚ ì§œ ì—…ë°ì´íŠ¸
                console.log(`[${difficulty}] Today is new day. Adding ${newQuizCount} new quizzes.`);
            } else {
                // ì˜¤ëŠ˜ ë‘ ë²ˆì§¸ ì´í›„ ì ‘ì†: 4ê°œ ì¶”ê°€
                newQuizCount = 4;
                console.log(`[${difficulty}] Same day access. Adding ${newQuizCount} new quizzes.`);
            }

            // 2. í˜„ì¬ í’€ì— ì—†ëŠ” ì „ì²´ ë¬¸ì œ ID ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            const allQuizIds = mockQuizzesArray
                .filter(q => q.difficulty === difficulty)
                .map(q => q.id);

            const unusedIds = allQuizIds.filter(id => !currentPool.includes(id));

            // 3. ì‹ ê·œ ë¬¸ì œ ëœë¤ìœ¼ë¡œ ì„ íƒí•˜ì—¬ í’€ì— ì¶”ê°€
            if (unusedIds.length > 0) {
                const shuffledUnused = unusedIds.sort(() => 0.5 - Math.random());
                const toAdd = shuffledUnused.slice(0, newQuizCount);
                
                // ê¸°ì¡´ í’€ì— ì¶”ê°€
                quizState.pools[difficulty] = [...currentPool, ...toAdd];
                
                console.log(`[${difficulty}] Added ${toAdd.length} new quizzes. Total pool size: ${quizState.pools[difficulty].length}`);
            } else {
                console.log(`[${difficulty}] No more unused quizzes to add.`);
            }
            
            // 4. ìƒíƒœ ì €ì¥
            await saveQuizState();
        }

        /** @description í€´ì¦ˆë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. */
        window.startNewQuiz = async (difficulty) => {
            selectedDifficulty = difficulty;
            
            // 1. í€´ì¦ˆ í’€ ì—…ë°ì´íŠ¸ ë¡œì§ ì‹¤í–‰ (8ê°œ ë˜ëŠ” 4ê°œ ì¶”ê°€)
            await updateQuizPool(difficulty);

            // 2. í˜„ì¬ ì‚¬ìš© ê°€ëŠ¥í•œ í’€ ê°€ì ¸ì˜¤ê¸°
            const availableIds = quizState.pools[difficulty];

            // 3. í€´ì¦ˆ ì„¸ì…˜ ìƒì„± (ìµœëŒ€ 10ê°œ)
            if (availableIds.length === 0) {
                contentDiv.innerHTML = `<p class="text-center text-red-400">í˜„ì¬ ì„ íƒ ê°€ëŠ¥í•œ í€´ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                return;
            }

            // í’€ì—ì„œ ëœë¤ìœ¼ë¡œ 10ë¬¸ì œ ì„ íƒ (í’€ì´ 10ê°œ ë¯¸ë§Œì´ë©´ ëª¨ë‘ ì„ íƒ)
            const quizIdsForSession = availableIds
                .sort(() => 0.5 - Math.random())
                .slice(0, 10);
            
            // IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤ì œ í€´ì¦ˆ ê°ì²´ ë¡œë“œ
            currentQuizSet = quizIdsForSession.map(id => allQuizzes[id]);
            currentQuizIndex = 0;
            
            // í€´ì¦ˆ ì‹œì‘
            renderQuizQuestion();
        };


        // =========================================================================
        // 6. UI ë Œë”ë§ ë° ë¡œì§ (ë³€ê²½ ì—†ìŒ)
        // =========================================================================

        /** @description ë©”ì¸ ë©”ë‰´ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. */
        window.renderMainMenu = () => {
            if (timerInterval) clearInterval(timerInterval);
            currentQuizSet = [];
            currentQuizIndex = 0;

            // ë³µìŠµ ëª¨ë“œë¥¼ ìœ„í•œ í‹€ë¦° ë¬¸ì œ ê°œìˆ˜ ê³„ì‚° (ì¤‘ë³µ ID ì œê±°)
            const incorrectQuizIds = [...new Set(quizHistory
                .filter(h => !h.isCorrect)
                .map(h => h.quizId)
            )];
            const reviewItems = incorrectQuizIds.length;
            
            const totalPlayed = quizHistory.length;
            const correctCount = quizHistory.filter(h => h.isCorrect).length;
            const accuracy = totalPlayed > 0 ? ((correctCount / totalPlayed) * 100).toFixed(1) : 0;

            contentDiv.innerHTML = `
                <div id="content-title" class="text-2xl font-semibold mb-6 text-center text-white">ë©”ì¸ ë©”ë‰´</div>
                
                <!-- í˜„ì¬ ìƒíƒœ ì¹´ë“œ -->
                <div class="bg-[#2e2e4d] p-6 rounded-xl shadow-lg mb-6">
                    <p class="text-xl font-bold mb-3 text-white">ë‚´ í€´ì¦ˆ ê¸°ë¡</p>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div>
                            <p class="text-sm text-gray-400">ì´ í‘¼ ë¬¸ì œ</p>
                            <p class="text-2xl font-extrabold text-indigo-400">${totalPlayed}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">ì •ë‹µë¥ </p>
                            <p class="text-2xl font-extrabold text-green-400">${accuracy}%</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-400">ë³µìŠµ í•„ìš”</p>
                            <p class="text-2xl font-extrabold text-red-400">${reviewItems}</p>
                        </div>
                    </div>
                </div>

                <!-- ë‚œì´ë„ ì„ íƒ -->
                <p class="text-xl font-bold mb-4 text-white">ìƒˆ í€´ì¦ˆ ì‹œì‘ (10ë¬¸ì œ)</p>
                <div class="grid grid-cols-3 gap-4 mb-6">
                    ${['Easy', 'Normal', 'Hard'].map(diff => `
                        <button 
                            class="gradient-button py-3 rounded-xl text-lg shadow-md hover:shadow-xl" 
                            onclick="startNewQuiz('${diff}')">
                            ${diff}
                        </button>
                    `).join('')}
                </div>

                <!-- ë³µìŠµ ëª¨ë“œ ë²„íŠ¼ -->
                ${reviewItems > 0 ? `
                    <p class="text-xl font-bold mb-4 text-white">ì˜¤ë‹µ ë³µìŠµ</p>
                    <button 
                        class="gradient-button w-full py-3 rounded-xl text-lg shadow-lg" 
                        onclick="startReviewMode()">
                        í‹€ë¦° ë¬¸ì œ ë³µìŠµí•˜ê¸° (${reviewItems}ê°œ)
                    </button>
                ` : `
                    <div class="text-center p-4 text-gray-400 bg-[#2e2e4d] rounded-xl">
                        <p>í‹€ë¦° ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤. ì™„ë²½í•´ìš”!</p>
                    </div>
                `}
                
                <!-- í˜„ì¬ í’€ ìƒíƒœ (ë””ë²„ê·¸/ì •ë³´ìš©) -->
                <div class="mt-6 p-4 text-xs text-gray-400 bg-[#2e2e4d] rounded-xl">
                    <p class="font-bold mb-1">í’€ ìƒíƒœ (ì˜¤ëŠ˜ ë‚ ì§œ: ${getTodayDate()})</p>
                    ${['Easy', 'Normal', 'Hard'].map(diff => `
                        <p>â€¢ ${diff}: ${quizState.pools[diff]?.length || 0} / ${mockQuizzesArray.filter(q => q.difficulty === diff).length} ë¬¸ì œ</p>
                    `).join('')}
                </div>
            `;
        };
        
        /** @description í˜„ì¬ í€´ì¦ˆ ë¬¸ì œë¥¼ ë Œë”ë§í•˜ê³  íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. */
        function renderQuizQuestion() {
            if (currentQuizIndex >= currentQuizSet.length) {
                endQuiz();
                return;
            }

            const currentQuiz = currentQuizSet[currentQuizIndex];
            timeRemaining = 15; // íƒ€ì´ë¨¸ ì´ˆê¸°í™”

            // íƒ€ì´ë¨¸ ì •ë¦¬ í›„ ì¬ì‹œì‘
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeRemaining--;
                const timerElement = document.getElementById('quiz-timer');
                if (timerElement) {
                    timerElement.innerText = timeRemaining.toString().padStart(2, '0');
                }
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    handleAnswer(null, -1); // ì‹œê°„ ì´ˆê³¼ ì²˜ë¦¬ (-1ì€ ì‚¬ìš©ì ì„ íƒì´ ì—†ì—ˆìŒì„ ì˜ë¯¸)
                }
            }, 1000);

            contentDiv.innerHTML = `
                <div class="quiz-card w-full p-6 shadow-2xl">
                    <!-- í—¤ë” -->
                    <div class="flex justify-between items-center mb-6 border-b pb-4 border-[#3e3e5d]">
                        <h2 class="text-xl font-semibold text-indigo-400">
                            ëœë¤ ìƒì‹ í€´ì¦ˆ (ë‚œì´ë„: ${selectedDifficulty})
                        </h2>
                        <div class="flex space-x-4">
                            <span class="text-lg font-bold text-gray-300">${currentQuizIndex + 1} / ${currentQuizSet.length}</span>
                            <span id="quiz-timer" class="text-lg font-bold text-red-400">15</span>
                        </div>
                    </div>

                    <!-- í€´ì¦ˆ ë‚´ìš© -->
                    <div class="quiz-content p-4 rounded-xl bg-[#2e2e4d] mb-6 min-h-[120px] flex items-center justify-center text-center">
                        <p id="quiz-question" class="text-2xl font-bold text-yellow-300 break-words">
                            ${currentQuiz.question}
                        </p>
                    </div>
                    
                    <!-- ì˜µì…˜ ë²„íŠ¼ -->
                    <div id="quiz-options" class="grid grid-cols-1 gap-4">
                        ${currentQuiz.options.map((option, index) => `
                            <button 
                                class="option-button w-full py-3 rounded-xl text-md shadow-md text-left px-4"
                                onclick="handleAnswer(this, ${index})">
                                ${index + 1}. ${option}
                            </button>
                        `).join('')}
                    </div>
                    <!-- í•´ì„¤ ì˜ì—­ -->
                    <div id="quiz-explanation" class="mt-6 hidden"></div>
                </div>
            `;
        }
        
        /** @description ì •ë‹µì„ í™•ì¸í•˜ê³  UIë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. */
        window.handleAnswer = (selectedButton, selectedIndex) => {
            if (timerInterval) clearInterval(timerInterval); // íƒ€ì´ë¨¸ ì¤‘ì§€
            
            const optionsDiv = document.getElementById('quiz-options');
            const buttons = optionsDiv.querySelectorAll('button');
            const currentQuiz = currentQuizSet[currentQuizIndex];
            
            // selectedIndexê°€ -1ì´ë©´ ì‹œê°„ ì´ˆê³¼ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.
            const isCorrect = selectedIndex !== -1 && selectedIndex === currentQuiz.answerIndex;
            
            // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
            buttons.forEach(btn => btn.disabled = true);
            
            // UI ì—…ë°ì´íŠ¸ ë° ê¸°ë¡ ì €ì¥
            buttons.forEach((btn, index) => {
                const isSelected = index === selectedIndex;
                const isAnswer = index === currentQuiz.answerIndex;

                if (isAnswer) {
                    btn.classList.add('correct');
                    btn.innerHTML += ' &check; ì •ë‹µ';
                } else if (isSelected && !isAnswer) {
                    btn.classList.add('incorrect');
                    btn.innerHTML += ' &times; ì˜¤ë‹µ';
                } else {
                    btn.classList.add('faded-out');
                }
            });

            // ì‹œê°„ ì´ˆê³¼ ë©”ì‹œì§€ í‘œì‹œ
            if (selectedIndex === -1) {
                 const questionEl = document.getElementById('quiz-question');
                 questionEl.innerHTML = `<span class="text-red-500">ì‹œê°„ ì´ˆê³¼!</span><br/>${currentQuiz.question}`;
            }
            
            // í•´ì„¤ ë Œë”ë§
            const explanationDiv = document.getElementById('quiz-explanation');
            explanationDiv.classList.remove('hidden');
            explanationDiv.innerHTML = `
                <div class="bg-[#3e3e5d] p-4 rounded-xl">
                    <p class="text-lg font-bold text-indigo-300 mb-2">ğŸ’¡ í•´ì„¤</p>
                    <p class="text-gray-200">${currentQuiz.explanation}</p>
                </div>
            `;
            
            // ê²°ê³¼ ì €ì¥ (ì‹œê°„ ì´ˆê³¼ ì‹œì—ë„ ì˜¤ë‹µìœ¼ë¡œ ì €ì¥)
            saveQuizResult(currentQuiz.id, isCorrect, currentQuiz.difficulty);
            
            // ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ ì¶”ê°€
            const nextButton = document.createElement('button');
            nextButton.className = 'gradient-button w-full py-3 rounded-xl text-lg shadow-lg mt-6';
            nextButton.innerText = 'ë‹¤ìŒ ë¬¸ì œë¡œ';
            nextButton.onclick = () => {
                currentQuizIndex++;
                renderQuizQuestion();
            };
            optionsDiv.parentNode.appendChild(nextButton);
        }

        /** @description í€´ì¦ˆë¥¼ ì¢…ë£Œí•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. */
        function endQuiz() {
            if (timerInterval) clearInterval(timerInterval);
            
            const total = currentQuizSet.length;
            // í€´ì¦ˆ ì„¸íŠ¸ì˜ IDë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì •ë‹µ/ì˜¤ë‹µì„ ê³„ì‚°í•©ë‹ˆë‹¤.
            const quizSetIds = currentQuizSet.map(q => q.id);
            // ìµœê·¼ í€´ì¦ˆ ì„¸ì…˜ì˜ ê²°ê³¼ë§Œ í•„í„°ë§í•©ë‹ˆë‹¤. (quizHistoryëŠ” onSnapshotì— ì˜í•´ ì—…ë°ì´íŠ¸ë¨)
            const recentHistory = quizHistory.filter(h => quizSetIds.includes(h.quizId)); 
            const correctAnswers = recentHistory.filter(h => h.isCorrect).length;
            const score = correctAnswers / total;

            contentDiv.innerHTML = `
                <div class="quiz-card w-full text-center p-8 shadow-2xl">
                    <p class="text-4xl font-extrabold mb-4 ${score >= 0.7 ? 'text-green-400' : 'text-red-400'}">
                        í€´ì¦ˆ ì™„ë£Œ!
                    </p>
                    <p class="text-2xl font-bold mb-2">
                        ${correctAnswers} / ${total} ì •ë‹µ
                    </p>
                    <p class="text-xl mb-8 text-gray-300">
                        ì •ë‹µë¥ : ${(score * 100).toFixed(1)}%
                    </p>
                    
                    <button class="gradient-button w-full py-3 rounded-xl text-lg shadow-lg" onclick="renderMainMenu()">
                        ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            `;
        }

        // =========================================================================
        // 7. ë³µìŠµ ëª¨ë“œ
        // =========================================================================

        /** @description ë³µìŠµ ëª¨ë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. */
        window.startReviewMode = () => {
            if (timerInterval) clearInterval(timerInterval);
            
            // 1. í‹€ë¦° ë¬¸ì œì˜ ê³ ìœ  ID ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const incorrectQuizIds = [...new Set(quizHistory
                .filter(h => !h.isCorrect)
                .map(h => h.quizId)
            )];

            // 2. ì „ì²´ í€´ì¦ˆ ëª©ë¡ì—ì„œ í•´ë‹¹ IDì˜ ë¬¸ì œë§Œ í•„í„°ë§í•©ë‹ˆë‹¤.
            const reviewSetTemp = incorrectQuizIds
                .map(id => allQuizzes[id])
                .filter(q => q !== undefined); // mockQuizzesì— ì—†ëŠ” IDëŠ” ì œì™¸

            if (reviewSetTemp.length === 0) {
                endReview(); 
                return;
            }
            
            // 3. ë³µìŠµí•  ë¬¸ì œë¥¼ ë¦¬ë·° ì„¸íŠ¸ë¡œ ì§€ì •í•˜ê³  ì¸ë±ìŠ¤ ì´ˆê¸°í™”
            reviewSet = reviewSetTemp;
            currentQuizIndex = 0;
            renderReviewQuestion();
        };

        /** @description í˜„ì¬ ë³µìŠµ ë¬¸ì œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤. */
        function renderReviewQuestion() {
            if (currentQuizIndex >= reviewSet.length) {
                endReview();
                return;
            }

            const currentQuiz = reviewSet[currentQuizIndex];
            const totalReview = reviewSet.length;

            contentDiv.innerHTML = `
                <div class="quiz-card w-full p-6 shadow-2xl">
                    <!-- í—¤ë” -->
                    <div class="flex justify-between items-center mb-6 border-b pb-4 border-[#3e3e5d]">
                        <h2 class="text-xl font-semibold text-red-400">
                            ì˜¤ë‹µ ë³µìŠµ ëª¨ë“œ
                        </h2>
                        <span class="text-lg font-bold text-gray-300">${currentQuizIndex + 1} / ${totalReview}</span>
                    </div>

                    <!-- í€´ì¦ˆ ë‚´ìš© -->
                    <div class="quiz-content p-4 rounded-xl bg-[#2e2e4d] mb-6 min-h-[120px] flex items-center justify-center text-center">
                        <p id="quiz-question" class="text-2xl font-bold text-yellow-300 mb-4 break-words">
                            ${currentQuiz.question}
                        </p>
                    </div>
                    
                    <!-- ì •ë‹µ ë° í•´ì„¤ í‘œì‹œ -->
                    <div class="bg-[#3e3e5d] p-4 rounded-xl mb-6">
                        <p class="text-lg font-bold text-green-400 mb-2">âœ… ì •ë‹µ: ${currentQuiz.options[currentQuiz.answerIndex]}</p>
                        <p class="text-lg font-bold text-indigo-300 mt-4 mb-2">ğŸ’¡ í•´ì„¤</p>
                        <p class="text-gray-200">${currentQuiz.explanation}</p>
                    </div>

                    <!-- ë²„íŠ¼ -->
                    <div class="grid grid-cols-2 gap-4">
                        <button class="option-button w-full py-3 rounded-xl text-lg shadow-md"
                            onclick="window.removeReviewItem('${currentQuiz.id}')">
                            ì™„ë²½íˆ ì´í•´í–ˆì–´ìš”! (ì œê±°)
                        </button>
                        <button class="gradient-button w-full py-3 rounded-xl text-lg shadow-md"
                            onclick="window.nextReviewQuestion()">
                            ë‹¤ìŒ ë¬¸ì œë¡œ
                        </button>
                    </div>
                </div>
            `;
        }

        /** @description ë‹¤ìŒ ë³µìŠµ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤. */
        window.nextReviewQuestion = () => {
            currentQuizIndex++;
            renderReviewQuestion();
        };
        
        /** * @description ë³µìŠµ ëª©ë¡ì—ì„œ í•´ë‹¹ ë¬¸ì œë¥¼ ì œê±°í•˜ê³  íˆìŠ¤í† ë¦¬ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
         * ì´ í•¨ìˆ˜ëŠ” Firestoreì—ì„œ í•´ë‹¹ ë¬¸ì œì˜ ì˜¤ë‹µ ê¸°ë¡ì„ ì˜êµ¬ ì‚­ì œí•˜ì—¬ 
         * ìƒˆë¡œê³ ì¹¨ í›„ì—ë„ ëª©ë¡ì— ë‹¤ì‹œ ë‚˜íƒ€ë‚˜ì§€ ì•Šë„ë¡ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.
         */
        window.removeReviewItem = async (quizId) => { // async í•¨ìˆ˜ë¡œ ë³€ê²½
            const isFirestore = db && userId && !userId.startsWith('error-') && !userId.startsWith('anon-') && !userId.startsWith('anonymous-');

            if (isFirestore) {
                // Firestore í™˜ê²½: í•´ë‹¹ í€´ì¦ˆ IDì˜ 'ì˜¤ë‹µ' ë¬¸ì„œë“¤ì„ ì°¾ì•„ ì˜êµ¬ ì‚­ì œ
                try {
                    const q = query(
                        getHistoryCollectionRef(),
                        where("quizId", "==", quizId),
                        where("isCorrect", "==", false)
                    );
                    const snapshot = await getDocs(q);
                    
                    if (snapshot.docs.length > 0) {
                        for (const docSnapshot of snapshot.docs) {
                            await deleteDoc(docSnapshot.ref);
                        }
                        console.log(`Successfully deleted ${snapshot.docs.length} incorrect history entries for quizId: ${quizId} from Firestore.`);
                    }
                    // Firestore ì‚­ì œ í›„ onSnapshotì— ì˜í•´ quizHistoryê°€ ìë™ ì—…ë°ì´íŠ¸ë˜ë¯€ë¡œ ë¡œì»¬ í•„í„°ë§ì€ ìƒëµ
                } catch (error) {
                    console.error("Error deleting history from Firestore:", error);
                    // Firestore ì˜¤ë¥˜ ë°œìƒ ì‹œ ì„ì‹œë¡œ LocalStorage fallbackì„ ì ìš©í•˜ì—¬ UIëŠ” ì§„í–‰ì‹œí‚´
                    quizHistory = quizHistory.filter(h => !(h.quizId === quizId && !h.isCorrect));
                }
            } else {
                // LocalStorage í™˜ê²½: ë¡œì»¬ ë°°ì—´ì—ì„œ í•´ë‹¹ ë¬¸ì œì˜ ì˜¤ë‹µ ê¸°ë¡ë§Œ ì œê±° í›„ ì €ì¥
                quizHistory = quizHistory.filter(h => !(h.quizId === quizId && !h.isCorrect));
                saveQuizHistory(quizHistory);
            }
            
            // 2. í˜„ì¬ ë³µìŠµ ì…‹(`reviewSet`)ì—ì„œ í•´ë‹¹ ë¬¸ì œ ì œê±° (ë¡œì»¬ UI ì—…ë°ì´íŠ¸ìš©)
            const newReviewSet = reviewSet.filter(q => q.id !== quizId);
            reviewSet = newReviewSet;
            
            // 3. ì¸ë±ìŠ¤ ì¡°ì • ë° ë‹¤ìŒ ë Œë”ë§
            if (reviewSet.length === 0) {
                currentQuizIndex = 0; 
                endReview();
                return;
            } else {
                // í˜„ì¬ ì¸ë±ìŠ¤ê°€ ìƒˆ ë°°ì—´ ê¸¸ì´ë¥¼ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ë³´ì •
                currentQuizIndex = Math.min(currentQuizIndex, reviewSet.length - 1);
            } 
            renderReviewQuestion();
        };

        /** @description ë³µìŠµ ëª¨ë“œë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤. */
        function endReview() {
            // íƒ€ì´ë¨¸ ì •ë¦¬
            if (timerInterval) clearInterval(timerInterval);

            contentDiv.innerHTML = `
                <div class="quiz-card w-full text-center p-8 shadow-2xl">
                    <p class="text-4xl font-extrabold mb-4 text-green-400">ë³µìŠµ ì™„ë£Œ!</p>
                    <p class="text-xl mb-8">
                        í‹€ë ¸ë˜ ëª¨ë“  ë¬¸ì œë¥¼ í™•ì¸í•˜ì…¨ìŠµë‹ˆë‹¤.
                    </p>
                    
                    <button class="gradient-button w-full py-3 rounded-xl text-lg shadow-lg" onclick="renderMainMenu()">
                        ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
                    </button>
                </div>
            `;
        }
        
        // =========================================================================
        // 8. ì´ˆê¸° ë¡œë“œ
        // =========================================================================

        initializeFirebase();
        
    </script>
</body>
</html>